#Load Required Packages
library(DBI)
library(RSQLite)
library(rSOILWAT2)
#Number of cores
proc_count<-6
source.dir<-"/Users/81771/Desktop/rSFSTEP2/StepWat_R_Wrapper_Parallel"
setwd(source.dir)
#Database location, edit the name of the weather database accordingly
database_name<-"dbWeatherData_Sagebrush_KP.v3.2.0.sqlite"
#Query script (Loads data from the database into a list)
query.file<-paste(source.dir,"RSoilWat31.Weather.Data.Query_V2.R", sep="")
#Assembly script (Assemble data with respect to years and conditions)
assemble.file<-paste(source.dir,"Weather.Assembly.Choices_V2.R", sep="")
#Markov script (To generate cov and prob files)
markov.file<-paste(source.dir,"Markov.Weather_V2.R",sep="")
#Wrapper script
wrapper.file<-paste(source.dir,"StepWat.Wrapper.Code_V3.R", sep="")
#Output script
output.file<-paste(source.dir,"SoilWatOutput.R", sep="")
#Start timing for timing statistics
tick_on<-proc.time()
#rSFSTEP2 will automatically populate the site string with the sites specified in generate_stepwat_sites.sh
site<-c(sitefolderid)#,2,3,4,5,6,7,8,9,10)
site<-1
#Read in Input Species CSV data
species_data <- read.csv("InputData_Species.csv", header=TRUE, sep=",")
db_loc
#Read in Input Species CSV data
species_data <- read.csv("InputData_Species.csv", header=TRUE, sep=",")
#Get all sites listed in the CSV
species_data_all_sites<-unique(species_data$Site)
species_data_all_sites
#Service multiple sites separated by comma in the csv
if(any(grepl(",",species_data_all_sites))==TRUE)
{
#Get all multiple sites
species_data_all_sites_vectors<-species_data_all_sites[grepl(",",species_data_all_sites)]
#Iterate through each multiple site
for(j in species_data_all_sites_vectors)
{
#if the site under inspection exists in multiple sites in the csv
if(grepl(site,j))
{
#Get data for the multiple sites containing site under inspection from CSV
species_data_site<-species_data[species_data$Site==j,]
#List all treatments associated with the multiple sites
treatments_vector_species<-unique(species_data_site$treatment)
setwd("STEPWAT_DIST")
#Iterate through each treatment
for(i in treatments_vector_species)
{
#Get data for the specific treatment
df=species_data_site[species_data_site$treatment==i,]
#Get rid of site and treatment columns
df <- subset(df, select = -c(1,2) )
#Write the specifies .in file
write.table(df, file = paste0("species_",i,"_vector_",site,".in"),quote = FALSE,row.names=FALSE,col.names = FALSE,sep="\t")
}
setwd("..")
}
}
}
#Get species data for the site or all sites
species_data_site<-species_data[species_data$Site==site | species_data$Site=="all",]
#Get all treatments associated with the site or all sites
treatments_species<-unique(species_data_site$treatment)
setwd("STEPWAT_DIST")
#Write file for each treatment for the specific site or "all" sites in the CSV
for(i in treatments_species)
{
#Get data for a specific treatment
df=species_data_site[species_data_site$treatment==i,]
#Get rid of first two columns i.e. site id and treatment type
df <- subset(df, select = -c(1,2) )
#Write the species.in file
write.table(df, file = paste0("species_",i,"_",site,".in"),quote=FALSE,row.names=FALSE,col.names = FALSE,sep="\t")
}
#Get all files created above for species
treatments_species<-as.character(treatments_species)
treatments_species <- paste("species_",treatments_species,sep="")
treatments_vector_species<-as.character(treatments_vector_species)
treatments_vector_species <- paste("species_",treatments_vector_species, "_vector", sep="")
treatments_species
treatments_vector_species
#Soil types are specified here, in accordance with the files added to input folder
#File names of all created species files above are all now stored in species variable
species<-c(treatments_species,treatments_vector_species)#c("soils.17sand.13clay","soils.68sand.10clay") #KS: uncommented to test overhaul of inputs
species
species<-paste(species,site,".in",sep="")
species
del(species)
remove(species)
#Soil types are specified here, in accordance with the files added to input folder
#File names of all created species files above are all now stored in species variable
species<-c(treatments_species,treatments_vector_species)#c("soils.17sand.13clay","soils.68sand.10clay") #KS: uncommented to test overhaul of inputs
species<-paste(species,"_",site,".in",sep="")
spcies
species
#append species_template.in to all the created files
for (i in species)
{
system(paste("cat ","species_template.in>>",i,sep=""))
}
